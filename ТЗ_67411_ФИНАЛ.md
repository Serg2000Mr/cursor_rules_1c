# ТЗ №67411: Разбивка МНН и дозировок на действующие вещества

> **Версия:** 3.0 (финальная)  
> **Дата:** 16.01.2026  
> **Связанный наряд:** 67474 (использует данные регистров)

---

## 1. Цель

Добавить возможность хранить информацию о действующих веществах в составе МНН и их количестве в дозировках.

**Результат:** Система сможет рассчитывать количество ДВ в упаковках (реализуется в наряде 67474).

---

## 2. Глоссарий

| Термин | Расшифровка |
|--------|-------------|
| МНН | Международное непатентованное наименование |
| ДВ | Действующее вещество |
| ЛП | Лекарственный препарат |

---

## 3. Что создать

### 3.1. Регистр сведений "гк_РазбивкаМННнаДВ"

**Назначение:** Хранит список ДВ в составе МНН.

| Поле | Тип | Роль | Примечание |
|------|-----|------|------------|
| МНН | СправочникСсылка.МНН | Измерение | — |
| ДействующееВещество | СправочникСсылка.МНН | Измерение | Отбор: ДействующееВещество = Истина |
| НомерДВ | Строка (2) | Ресурс | Автоинкремент с возможностью корректировки |

**Пример данных:**
| МНН | ДВ | НомерДВ |
|-----|-----|---------|
| Ко-амоксиклав | Амоксициллин | 1 |
| Ко-амоксиклав | Клавулановая кислота | 2 |

---

### 3.2. Регистр сведений "гк_РазбивкаДозировкинаДВ"

**Назначение:** Хранит количество каждого ДВ в дозировке.

| Поле | Тип | Роль | Примечание |
|------|-----|------|------------|
| Дозировка | СправочникСсылка.ДозировкиЛекарственныхСредств | Измерение | — |
| НомерКомпонентаЛП | Строка (2) | Измерение | По умолчанию "1" |
| НомерДВ | Строка (2) | Измерение | Автоинкремент с возможностью корректировки |
| КоличествоДВ | Число (12,3) | Ресурс | — |
| ЕдиницаИзмеренияДВ | СправочникСсылка.УпаковкиЕдиницыИзмерения | Ресурс | Только не-упаковки |

**Пример данных:**
| Дозировка | №Комп | №ДВ | Кол-во | ЕИ |
|-----------|-------|-----|--------|-----|
| 500+125 мг | 1 | 1 | 500 | мг |
| 500+125 мг | 1 | 2 | 125 | мг |

> **ВАЖНО:** Регистры связываются по полю `НомерДВ` для расчётов в наряде 67474.

---

## 4. Что доработать

### 4.1. Форма справочника МНН

**Добавить гиперссылку "Действующие вещества":**
- Расположение: панель гиперссылок (после категорий производителей)
- Действие: открывает список регистра с отбором по текущему МНН
- Режим: добавление, изменение, удаление записей

**При создании записи:**
- `МНН` → текущий элемент (автоматически)
- `НомерДВ` → max(НомерДВ) + 1 для данного МНН
- `ДВ` → выбор с отбором `ДействующееВещество = Истина` (отбор можно снять)

---

### 4.2. Справочник "ДозировкиЛекарственныхСредств"

**Новые реквизиты:**
| Реквизит | Тип | Примечание |
|----------|-----|------------|
| гк_КоличествоЛП | Число (12,3) | Количество ЛП в дозировке |
| гк_ЕдиницаИзмеренияЛП | СправочникСсылка.УпаковкиЕдиницыИзмерения | Только не-упаковки |

**Доступность реквизитов:** Только при наличии роли на изменение регистра или полных прав.

**Гиперссылка "Разбивка на действующие вещества":**
- Видимость: переключатель = "Несколько действующих веществ"
- Действие: открывает список регистра с отбором

**При создании записи:**
- `Дозировка` → текущий элемент (автоматически)
- `НомерКомпонентаЛП` → "1" (можно изменить)
- `НомерДВ` → автоинкремент с возможностью корректировки

---

## 5. Роли

| Роль | Права |
|------|-------|
| гк_РазбивкаМННнаДВ_Чтение | Чтение, Просмотр |
| гк_РазбивкаМННнаДВ_ИзменениеИДобавление | Чтение, Добавление, Изменение, Редактирование |
| гк_РазбивкаДозировкинаДВ_Чтение | Чтение, Просмотр |
| гк_РазбивкаДозировкинаДВ_ИзменениеИДобавление | Чтение, Добавление, Изменение, Редактирование |

**Добавить в профиль:** "Ответственный за ведение вариантов номенклатуры ДБП"

---

## 6. Размещение

| Объект | Где создавать |
|--------|---------------|
| Регистры сведений | Основная конфигурация |
| Реквизиты Дозировки | Основная конфигурация |
| Формы регистров | Расширение ГК_Основное |
| Доработки форм | Расширение ГК_Основное |
| Роли | Расширение ГК_Основное |

---

## 7. Особенности

1. **Заполнение регистров:** Обработкой, не вручную
2. **Доля ДВ ≠ 100%:** Допустимо (есть вспомогательные вещества)
3. **Проверка признака ДВ:** Не требуется сейчас
4. **Тип номеров:** Строка (как коды справочников)

---

## 8. Чек-лист приёмки

- [ ] Гиперссылка "Действующие вещества" на форме МНН
- [ ] Автоинкремент НомерДВ при создании записи
- [ ] Отбор по признаку ДВ работает
- [ ] Новые реквизиты в Дозировках
- [ ] Гиперссылка видна при "Несколько ДВ"
- [ ] Роли созданы и добавлены в профиль

---

**База тестирования:** `HQ_SQL_1C_TEST01_ERP_Tirazh_GrandCapital_ERP`
